<ng-container *ngIf="showShell(); else authLayout">
  <div class="app-container">
    <nav class="sidebar">
      <div class="sidebar-header">
        <div class="logo">
          <div class="logo-icon">
            <img src="assets/images/logo_dayfusion.png" alt="DayFusion Logo" />
            <div class="logo-reflection"></div>
            <div class="logo-text">
              <span class="logo-title">DayFusion</span>
              <span class="logo-subtitle">Reconhecimento Facial</span>
            </div>
          </div>
        </div>
      </div>

      <div class="sidebar-divider"></div>

      <ul class="nav-menu">
        <li class="nav-item">
          <a routerLink="/dashboard" routerLinkActive="active" class="nav-link">
            <span class="nav-icon">游늵</span>
            <span class="nav-text">Dashboard</span>
          </a>
        </li>
        <li class="nav-item">
          <a routerLink="/capture3d" routerLinkActive="active" class="nav-link">
            <span class="nav-icon">游</span>
            <span class="nav-text">Captura 3D</span>
          </a>
        </li>
        <li class="nav-item">
          <a routerLink="/history" routerLinkActive="active" class="nav-link">
            <span class="nav-icon">游늶</span>
            <span class="nav-text">Hist칩rico</span>
          </a>
        </li>
        <li class="nav-item">
          <a routerLink="/settings" routerLinkActive="active" class="nav-link">
            <span class="nav-icon">丘뙖잺</span>
            <span class="nav-text">Configura칞칫es</span>
          </a>
        </li>
        <li class="nav-item">
          <a routerLink="/help" routerLinkActive="active" class="nav-link">
            <span class="nav-icon">游닄</span>
            <span class="nav-text">Ajuda</span>
          </a>
        </li>

        <li class="nav-divider"></li>

        <!-- Menu do Usu치rio: Avatar com Nome e Dropdown no Hover -->
        <li class="nav-item user-menu-container" *ngIf="currentUser()">
          <div class="user-avatar-trigger">
            <div class="user-info-visible">
              <div class="avatar">
                <ng-container *ngIf="avatarUrl(); else avatarFallback">
                  <img [src]="avatarUrl()!" [alt]="displayName()" />
                </ng-container>
                <ng-template #avatarFallback>
                  <div class="avatar-fallback">{{ userInitials() }}</div>
                </ng-template>
              </div>
              <div class="user-name-visible">
                <span class="user-name-text">{{ displayName() }}</span>
                <span class="user-cpf-text">{{ displayCpf() }}</span>
              </div>
            </div>
            <div class="user-dropdown">
              <div class="user-dropdown-header">
                <div class="user-avatar-large">
                  <ng-container *ngIf="avatarUrl(); else avatarLargeFallback">
                    <img [src]="avatarUrl()!" [alt]="displayName()" />
                  </ng-container>
                  <ng-template #avatarLargeFallback>
                    <div class="avatar-fallback">{{ userInitials() }}</div>
                  </ng-template>
                </div>
                <div class="user-dropdown-info">
                  <span class="user-dropdown-name">
                    {{ displayName() }}
                    <span class="admin-badge-small" *ngIf="isAdmin()">ADMIN</span>
                  </span>
                  <span class="user-dropdown-cpf">CPF {{ displayCpf() }}</span>
                </div>
              </div>
              <div class="user-dropdown-divider"></div>
              <div class="user-dropdown-actions">
                <button type="button" class="dropdown-action" (click)="goToProfile()">
                  <span class="dropdown-icon">游녻</span>
                  <span>Meu Perfil</span>
                </button>
                <button type="button" class="dropdown-action admin-action" (click)="goToUserManagement()" *ngIf="isAdmin()">
                  <span class="dropdown-icon">游논</span>
                  <span>Gerenciar Usu치rios</span>
                  <span class="admin-badge-inline">ADMIN</span>
                </button>
                <div class="user-dropdown-divider" *ngIf="isAdmin()"></div>
                <button type="button" class="dropdown-action logout" (click)="logout()">
                  <span class="dropdown-icon">游뛁</span>
                  <span>Sair</span>
                </button>
              </div>
            </div>
          </div>
        </li>
      </ul>
    </nav>

    <main class="main-content">
      <div class="page-content">
        <router-outlet></router-outlet>
      </div>
    </main>
  </div>
</ng-container>

<ng-template #authLayout>
  <router-outlet></router-outlet>
</ng-template>

<!-- Modal de Sess칚o Expirada (Global) -->
<app-session-expired-modal></app-session-expired-modal>
