<ng-container *ngIf="showShell(); else authLayout">
  <div class="app-container">
    <header class="mobile-header">
      <button type="button" class="menu-toggle" (click)="toggleSidebar()" aria-label="Abrir menu">
        <span></span>
        <span></span>
        <span></span>
      </button>
      <div class="mobile-logo">
        <img src="assets/images/logo_dayfusion.png" alt="DayFusion Logo" />
        <div class="mobile-logo-text">
          <span>DayFusion</span>
          <small>Reconhecimento facial</small>
        </div>
      </div>
      <button class="mobile-profile" type="button" (click)="goToProfile()" *ngIf="currentUser()">
        <ng-container *ngIf="avatarUrl(); else mobileAvatarFallback">
          <img [src]="avatarUrl()!" [alt]="displayName()" />
        </ng-container>
        <ng-template #mobileAvatarFallback>
          <span>{{ userInitials() }}</span>
        </ng-template>
      </button>
    </header>

    <div class="layout-wrapper">
      <div class="sidebar-backdrop" *ngIf="isSidebarOpen()" (click)="closeSidebar()"></div>
      <nav class="sidebar" [class.open]="isSidebarOpen()">
        <button type="button" class="close-sidebar" (click)="closeSidebar()" aria-label="Fechar menu">
          ‚úï
        </button>
      <div class="sidebar-header">
        <div class="logo">
          <div class="logo-icon">
            <img src="assets/images/logo_dayfusion.png" alt="DayFusion Logo" />
            <div class="logo-reflection"></div>
            <div class="logo-text">
              <span class="logo-title">DayFusion</span>
              <span class="logo-subtitle">Reconhecimento Facial</span>
            </div>
          </div>
        </div>
      </div>

      <div class="sidebar-divider"></div>

      <ul class="nav-menu">
        <li class="nav-item">
          <a routerLink="/dashboard" routerLinkActive="active" class="nav-link">
            <span class="nav-text">Dashboard</span>
          </a>
        </li>
        <li class="nav-item">
          <a routerLink="/apresentacao" routerLinkActive="active" class="nav-link">
            <span class="nav-text">Apresenta√ß√£o</span>
          </a>
        </li>
        <li class="nav-item">
          <a routerLink="/capture3d" routerLinkActive="active" class="nav-link">
            <span class="nav-text">Captura 3D</span>
          </a>
        </li>
        <li class="nav-item">
          <a routerLink="/aws-widget" routerLinkActive="active" class="nav-link">
            <span class="nav-text">Widget AWS</span>
          </a>
        </li>
        <li class="nav-item">
          <a routerLink="/history" routerLinkActive="active" class="nav-link">
            <span class="nav-text">Hist√≥rico</span>
          </a>
        </li>
        <li class="nav-item" *ngIf="isAdmin()">
          <a routerLink="/verifications" routerLinkActive="active" class="nav-link">
            <span class="nav-text">Observa√ß√µes</span>
          </a>
        </li>
        <li class="nav-item">
          <a routerLink="/settings" routerLinkActive="active" class="nav-link">
            <span class="nav-text">Configura√ß√µes</span>
          </a>
        </li>
        <li class="nav-item" *ngIf="isAdmin()">
          <a routerLink="/logs" routerLinkActive="active" class="nav-link">
            <span class="nav-text">üìã Logs</span>
          </a>
        </li>
        <li class="nav-item">
          <a routerLink="/help" routerLinkActive="active" class="nav-link">
            <span class="nav-text">Ajuda</span>
          </a>
        </li>

        <li class="nav-divider"></li>

        <!-- Menu do Usu√°rio: Avatar com Nome e Dropdown no Hover -->
        <li class="nav-item user-menu-container" *ngIf="currentUser()">
          <div class="user-avatar-trigger">
            <div class="user-info-visible">
              <div class="avatar">
                <ng-container *ngIf="avatarUrl(); else avatarFallback">
                  <img [src]="avatarUrl()!" [alt]="displayName()" />
                </ng-container>
                <ng-template #avatarFallback>
                  <div class="avatar-fallback">{{ userInitials() }}</div>
                </ng-template>
              </div>
              <div class="user-name-visible">
                <span class="user-name-text">{{ displayName() }}</span>
                <span class="user-cpf-text">{{ displayCpf() }}</span>
              </div>
            </div>
            <div class="user-dropdown">
              <div class="user-dropdown-header">
                <div class="user-avatar-large">
                  <ng-container *ngIf="avatarUrl(); else avatarLargeFallback">
                    <img [src]="avatarUrl()!" [alt]="displayName()" />
                  </ng-container>
                  <ng-template #avatarLargeFallback>
                    <div class="avatar-fallback">{{ userInitials() }}</div>
                  </ng-template>
                </div>
                <div class="user-dropdown-info">
                  <span class="user-dropdown-name">
                    {{ displayName() }}
                    <span class="admin-badge-small" *ngIf="isAdmin()">ADMIN</span>
                  </span>
                  <span class="user-dropdown-cpf">CPF {{ displayCpf() }}</span>
                </div>
              </div>
              <div class="user-dropdown-divider"></div>
              <div class="user-dropdown-actions">
                <button type="button" class="dropdown-action" (click)="goToProfile()">
                  <span class="dropdown-icon">üë§</span>
                  <span>Meu Perfil</span>
                </button>
                <button type="button" class="dropdown-action admin-action" (click)="goToUserManagement()" *ngIf="isAdmin()">
                  <span class="dropdown-icon">üë•</span>
                  <span>Gerenciar Usu√°rios</span>
                  <span class="admin-badge-inline">ADMIN</span>
                </button>
                <button type="button" class="dropdown-action admin-action" (click)="goToVerifications()" *ngIf="isAdmin()">
                  <span class="dropdown-icon">üõ°Ô∏è</span>
                  <span>Observa√ß√µes</span>
                  <span class="admin-badge-inline">ADMIN</span>
                </button>
                <div class="user-dropdown-divider" *ngIf="isAdmin()"></div>
                <button type="button" class="dropdown-action logout" (click)="logout()">
                  <span class="dropdown-icon">üö™</span>
                  <span>Sair</span>
                </button>
              </div>
            </div>
          </div>
        </li>
      </ul>
    </nav>

      <main class="main-content" (click)="closeSidebar()">
        <div class="page-content">
          <router-outlet></router-outlet>
        </div>
      </main>
    </div>
  </div>
</ng-container>

<ng-template #authLayout>
  <router-outlet></router-outlet>
</ng-template>

<!-- Modal de Sess√£o Expirada (Global) -->
<app-session-expired-modal></app-session-expired-modal>
