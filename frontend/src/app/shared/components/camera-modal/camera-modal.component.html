<!-- Modal Fullscreen da C√¢mera -->
<div class="camera-modal" *ngIf="isOpen" (click)="onBackdropClick($event)">
  <div class="modal-content-fullscreen">
    <button class="modal-cancel" (click)="closeModal()">
      ‚úï Cancelar
    </button>
    
    <div class="camera-wrapper-fullscreen">
      <video 
        #videoElement 
        autoplay 
        playsinline 
        muted 
        class="camera-video-fullscreen"
      ></video>
      
      <!-- M√°scara de captura (apenas para 2D) -->
      <div class="camera-mask-overlay" *ngIf="mode === '2d'"></div>
      
      <!-- Overlay de c√¢mera (2D com detec√ß√£o facial) -->
      <div class="camera-overlay-fullscreen" *ngIf="cameraReady && mode === '2d'">
        <div class="capture-circle-fullscreen">
          <div class="alignment-guide-fullscreen vertical-line"></div>
          <div class="alignment-guide-fullscreen horizontal-line"></div>
          
          <div class="progress-ring-container">
            <svg class="progress-ring-fullscreen" viewBox="0 0 300 300">
              <circle class="progress-ring-circle"
                      cx="150" cy="150"
                      r="145"
                      fill="none"
                      stroke="#22c55e"
                      stroke-width="8"
                      [attr.stroke-dasharray]="progressDashArray"
                      [attr.stroke-dashoffset]="progressDashOffset"
                      stroke-linecap="round"
                      transform="rotate(-90 150 150)"/>
            </svg>
          </div>
        </div>
        
        <div class="detection-status">
          <span class="status-icon">{{ detectionStatus === 'ready' ? '‚úÖ' : 'üë§' }}</span>
          <span class="status-text">{{ getDetectionStatusText() }}</span>
        </div>
        
        <button class="capture-btn-fullscreen" 
                (click)="capturePhoto()" 
                [class.ready]="detectionStatus === 'ready'"
                [class.disabled]="detectionStatus !== 'ready'">
          <div class="capture-btn-inner-fullscreen"></div>
        </button>
      </div>

      <!-- Overlay de c√¢mera (3D com liveness) -->
      <div class="camera-overlay-fullscreen" *ngIf="cameraReady && mode === '3d'">
        <!-- Guia de rosto (igual ao 2D) -->
        <div class="capture-circle-fullscreen" *ngIf="!sessionActive">
          <div class="alignment-guide-fullscreen vertical-line"></div>
          <div class="alignment-guide-fullscreen horizontal-line"></div>
        </div>

        <!-- Status de detec√ß√£o -->
        <div class="detection-status" *ngIf="!sessionActive" [class.valid]="faceDetected">
          <span class="status-icon" [class.valid-icon]="faceDetected">{{ faceDetected ? '‚úÖ' : (validatingPosition ? '‚è≥' : 'üë§') }}</span>
          <span class="status-text" [class.valid-text]="faceDetected">{{ validationMessage || 'Aguardando valida√ß√£o...' }}</span>
        </div>

        <!-- Indicador de fase atual -->
        <div class="phase-indicator" *ngIf="sessionActive">
          <div class="phase-content">
            <span class="phase-icon">
              <span *ngIf="currentPhase === 'recording'">üìπ</span>
              <span *ngIf="currentPhase === 'processing'">‚è≥</span>
              <span *ngIf="currentPhase === 'completed'">‚úÖ</span>
            </span>
            <span class="phase-text">
              <span *ngIf="currentPhase === 'recording'">Grava√ß√£o em andamento...</span>
              <span *ngIf="currentPhase === 'processing'">Processando resultados...</span>
              <span *ngIf="currentPhase === 'completed'">Verifica√ß√£o conclu√≠da</span>
            </span>
          </div>
        </div>

        <!-- Indicador de etapa do liveness (direita, esquerda, piscar/sorrir) -->
        <div class="liveness-step-indicator" *ngIf="sessionActive && currentPhase === 'recording' && currentLivenessStep !== 'center'">
          <div class="step-content" [class.step-right]="currentLivenessStep === 'right'" 
               [class.step-left]="currentLivenessStep === 'left'"
               [class.step-blink-smile]="currentLivenessStep === 'blink_smile'"
               [class.step-completed]="currentLivenessStep === 'completed'">
            <div class="step-icon-large">
              <span *ngIf="currentLivenessStep === 'right'">‚û°Ô∏è</span>
              <span *ngIf="currentLivenessStep === 'left'">‚¨ÖÔ∏è</span>
              <span *ngIf="currentLivenessStep === 'blink_smile'">üëÅÔ∏èüòä</span>
              <span *ngIf="currentLivenessStep === 'completed'">‚úì</span>
            </div>
            <div class="step-text-large">{{ getLivenessStepText() }}</div>
          </div>
        </div>

        <!-- Controles na parte inferior -->
        <div class="liveness-controls-bottom">
          <div class="liveness-info" *ngIf="!sessionActive && !faceDetected">
            <p class="liveness-info-text">üì∏ Valida√ß√£o em tempo real</p>
            <p class="liveness-info-hint">Siga as instru√ß√µes de voz para posicionar corretamente</p>
          </div>
          
          <div class="liveness-info-ready" *ngIf="!sessionActive && faceDetected">
            <p class="liveness-info-text">‚úì Tudo certo! Iniciando automaticamente...</p>
          </div>

          <!-- Bot√£o redesenhado -->
          <button 
            class="btn-liveness-start btn-start-large" 
            [class.ready]="faceDetected"
            [class.disabled]="!faceDetected || validatingPosition"
            *ngIf="!sessionActive"
            (click)="startLiveness3D()"
            [disabled]="!faceDetected || validatingPosition">
            <span class="btn-icon-large">‚ñ∂</span>
            <span class="btn-text-large">Iniciar Verifica√ß√£o 3D</span>
            <span class="btn-subtitle" *ngIf="!faceDetected">Aguarde valida√ß√£o...</span>
          </button>

          <div class="liveness-active-status" *ngIf="sessionActive">
            <div class="active-status-badge">
              <div class="status-pulse-active"></div>
              <span *ngIf="currentPhase === 'recording'">Grava√ß√£o em andamento... Finaliza√ß√£o autom√°tica</span>
              <span *ngIf="currentPhase === 'processing'">Processando resultados...</span>
              <span *ngIf="currentPhase === 'completed'">Conclu√≠do</span>
            </div>
            
            <button class="btn-liveness-stop" (click)="stopLiveness()" *ngIf="currentPhase !== 'completed'">
              <span class="btn-liveness-icon">‚èπ</span>
              <span>Finalizar Manualmente</span>
            </button>
          </div>
        </div>
      </div>
      
      <!-- Loading overlay -->
      <div class="overlay-loading" *ngIf="cameraInitializing">
        <div class="overlay-content-loading">
          <div class="loading-spinner"></div>
          <p>Iniciando c√¢mera...</p>
        </div>
      </div>

      <!-- Erro overlay -->
      <div class="overlay-error" *ngIf="error && !cameraInitializing">
        <div class="overlay-content-error">
          <span class="error-icon">‚ö†Ô∏è</span>
          <p class="error-message">{{ error }}</p>
          <button class="btn btn-secondary" (click)="initializeCamera()">
            Tentar Novamente
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

