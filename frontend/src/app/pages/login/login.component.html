<section class="login-hero">
  <div class="hero-content">
    <div class="face-overlay"></div>
    <div class="face-flare"></div>
    <div class="hero-left">
      <h1 class="brand-title">DayFusion</h1>
      <p>Autenticação facial instantânea. Olhe para a câmera e confirme sua identidade.</p>
      <button type="button" class="cta-button" (click)="startFaceLogin()" [disabled]="isModalOpen() || isAuthenticating()">
        {{ isModalOpen() || isAuthenticating() ? 'Reconhecendo...' : 'Iniciar reconhecimento' }}
      </button>
      <span *ngIf="statusMessage()" class="status-message">
        {{ statusMessage() }}
      </span>
    </div>

    

    <div class="hero-right" *ngIf="showCpfFallback()">
      <div class="fallback-card">
        <h2>Não reconhecido?</h2>
        <p>Confirme seu CPF para localizar ou criar seu cadastro.</p>

        <form [formGroup]="form" (ngSubmit)="onSubmit()" novalidate>
          <label for="cpf">CPF</label>
          <input
            id="cpf"
            type="text"
            autocomplete="off"
            inputmode="numeric"
            placeholder="000.000.000-00"
            formControlName="cpf"
            (input)="onCpfInput($event)"
            [class.invalid]="isCpfInvalid()" />
          <small *ngIf="isCpfInvalid()" class="validation-message">
            CPF deve conter 11 dígitos.
          </small>

          <button type="submit" [disabled]="loading()">
            {{ loading() ? 'Verificando...' : 'Continuar com CPF' }}
          </button>
        </form>

        <p *ngIf="errorMessage()" class="error-message">
          {{ errorMessage() }}
        </p>
      </div>
    </div>
  </div>
</section>

<!-- Modal de Captura Facial para Autenticação -->
<div class="auth-modal-backdrop" *ngIf="isModalOpen()">
  <div class="auth-modal-content">
    <button
      type="button"
      class="auth-modal-close"
      (click)="closeModal()"
      aria-label="Fechar reconhecimento facial"
      *ngIf="!isAuthenticating()">
      ×
    </button>
    
    <!-- Vídeo durante captura -->
    <app-auth-video-modal
      *ngIf="!isAuthenticating()"
      [voiceSteps]="voiceSteps()"
      (sessionCompleted)="handleSessionCompleted($event)"
      (sessionFailed)="handleSessionFailed($event)">
    </app-auth-video-modal>
    
    <!-- Barra de progresso verde durante autenticação -->
    <div class="auth-progress-wrapper" *ngIf="isAuthenticating()">
      <div class="auth-progress-container-full">
        <div class="auth-progress-bar-full">
          <div class="auth-progress-fill-full" [style.width.%]="authProgress()"></div>
        </div>
        <p class="auth-progress-message">{{ statusMessage() || 'Autenticando...' }}</p>
      </div>
    </div>
  </div>
</div>

<!-- Modal de Espera/Autenticação -->
<div class="wait-modal-backdrop" *ngIf="showWaitModal()">
  <div class="wait-modal">
    <div class="wait-spinner">
      <div class="spinner-ring"></div>
      <div class="spinner-ring"></div>
      <div class="spinner-ring"></div>
    </div>
    <h2 class="wait-title">{{ waitModalTitle() }}</h2>
    <p class="wait-message">{{ waitModalMessage() }}</p>
    <div class="wait-modal-actions" *ngIf="waitModalClosable()">
      <button type="button" (click)="closeWaitModal()">Entendi</button>
    </div>
  </div>
</div>
