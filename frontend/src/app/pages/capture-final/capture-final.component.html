<div class="capture-final-page">
  <!-- Header -->
  <div class="page-header">
    <div class="header-icon">ğŸ­</div>
    <h1 class="page-title">Captura Final</h1>
    <p class="page-subtitle">VerificaÃ§Ã£o Facial 3D com AWS Face Liveness</p>
  </div>

  <!-- Card Principal -->
  <div class="main-card">
    <div class="card-content">
      <div class="info-section">
        <div class="info-icon">ğŸ›¡ï¸</div>
        <h2>VerificaÃ§Ã£o de Liveness 3D</h2>
        <p>Tecnologia AWS Rekognition para detecÃ§Ã£o de vitalidade facial com:</p>
        
        <ul class="features-list">
          <li>
            <span class="feature-icon">âœ¨</span>
            <span>Face Movement Challenge - Movimentos faciais</span>
          </li>
          <li>
            <span class="feature-icon">ğŸ’¡</span>
            <span>Light Challenge - Flash colorido para detecÃ§Ã£o de vida</span>
          </li>
          <li>
            <span class="feature-icon">ğŸ¯</span>
            <span>DetecÃ§Ã£o de mÃ¡scaras, fotos e vÃ­deos</span>
          </li>
          <li>
            <span class="feature-icon">ğŸ”’</span>
            <span>100% seguro e certificado pela AWS</span>
          </li>
        </ul>
      </div>

      <!-- BotÃ£o Principal -->
      <div class="action-section">
        <button 
          class="btn-start-verification" 
          (click)="startVerification()"
          [disabled]="isModalOpen()"
          type="button"
          aria-label="Iniciar verificaÃ§Ã£o facial">
          <span class="btn-icon">â–¶</span>
          <span class="btn-text">Iniciar VerificaÃ§Ã£o Facial</span>
        </button>
        
        <p class="btn-hint">
          Certifique-se de estar em um ambiente bem iluminado
        </p>
      </div>
    </div>
  </div>

  <!-- Resultado da VerificaÃ§Ã£o -->
  <div class="result-card" *ngIf="livenessResult() as result">
    <div class="result-header" [ngClass]="getStatusColor(result.status)">
      <div class="result-icon">{{ getStatusIcon(result.status) }}</div>
      <div class="result-info">
        <h3>{{ getStatusText(result.status) }}</h3>
        <p class="result-session">SessÃ£o: {{ result.sessionId }}</p>
      </div>
    </div>

    <div class="result-details">
      <div class="detail-item">
        <span class="detail-label">ConfianÃ§a</span>
        <span class="detail-value">{{ result.confidence | number:'1.0-0' }}%</span>
      </div>
      <div class="detail-item">
        <span class="detail-label">Status</span>
        <span class="detail-value" [class.success]="result.status === 'LIVE'" [class.danger]="result.status === 'FAKE'">
          {{ result.status }}
        </span>
      </div>
    </div>

    <!-- Imagens de Auditoria -->
    <div class="audit-images" *ngIf="result.auditImages && result.auditImages.length > 0">
      <h4>Imagens Capturadas</h4>
      <div class="images-grid">
        <div class="image-item" *ngFor="let img of result.auditImages; let i = index">
          <img [src]="img.url || '/api/media/liveness-frame?bucket=' + img.bucket + '&key=' + img.key" 
               [alt]="'Captura ' + (i + 1)"
               class="audit-image" />
          <span class="image-label">Captura {{ i + 1 }}</span>
        </div>
      </div>
    </div>

    <div class="result-actions">
      <button class="btn-secondary" (click)="startVerification()">
        ğŸ”„ Nova VerificaÃ§Ã£o
      </button>
      <button class="btn-secondary" (click)="goToHistory()">
        ğŸ“‹ Ver HistÃ³rico
      </button>
    </div>
  </div>

  <!-- Mensagem de Erro -->
  <div class="error-banner" *ngIf="errorMessage()">
    <span class="error-icon">âš ï¸</span>
    <span class="error-text">{{ errorMessage() }}</span>
  </div>
</div>

<!-- Modal de VerificaÃ§Ã£o (Widget AWS) -->
<app-liveness-modal-final
  *ngIf="isModalOpen()"
  [isOpen]="true"
  (close)="closeModal()"
  (complete)="onLivenessComplete($event)"
  (error)="onLivenessError($event)">
</app-liveness-modal-final>

