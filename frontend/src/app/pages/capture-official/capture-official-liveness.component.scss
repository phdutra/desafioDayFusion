/* ==========================================================================
   AWS Liveness - Layout Isolado (Angular 19)
   Seguindo guia: aws_amplify_liveness_correct.md
   ========================================================================== */

/* Modal base */
.liveness-modal {
  position: fixed;
  inset: 0;
 // background: rgba(0, 0, 0, 0.70);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 99999;
  backdrop-filter: blur(4px);
  opacity: 1;
  transition: opacity 0.4s ease-out, visibility 0.4s ease-out;
  visibility: visible;
  
  /* Estado de fadeout */
  &.fadeout {
    opacity: 0;
    visibility: hidden;
    pointer-events: none;
  }
}

/* Bot√£o fechar */
.close-button {
  position: absolute;
  top: 20px;
  right: 25px;
  font-size: 24px;
  background: transparent;
  border: none;
  color: white;
  cursor: pointer;
  z-index: 100000;
  width: 34px;
  height: 34px;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: background 0.2s;

  &:hover {
    background: rgba(255, 255, 255, 0.1);
  }
}

/* Wrapper isolado do widget AWS */
.liveness-aws-wrapper {
  position: relative;
  width: 480px;
  max-width: 90vw;
  height: 640px;
  max-height: 90vh;
  background: #000;
  border-radius: 12px;
  overflow: hidden;

  /* ESSENCIAL ‚Äî impede o Angular de deformar o widget */
  display: block;
  margin: 0 auto;
  z-index: 1;
}
.review-wrapper {
  width: min(960px, 90vw);
  max-height: 90vh;
  background: rgba(7, 11, 25, 0.92);
  backdrop-filter: blur(18px);
  -webkit-backdrop-filter: blur(18px);
  border-radius: 18px;
  padding: 32px;
  overflow-y: auto;
  box-shadow:
    0 20px 45px rgba(0, 0, 0, 0.5),
    0 0 0 1px rgba(255, 255, 255, 0.05);
  color: #f9fafb;
  display: flex;
  justify-content: center;
}


/* Container AWS (n√£o mexer no layout interno) */
#aws-liveness-container {
  width: 100%;
  height: 100%;
  display: block !important;
  position: relative;
  z-index: 1;
  margin: 0;
  padding: 0;
  
  /* Garantir que o widget AWS ocupe todo o espa√ßo */
  min-height: 100%;
  min-width: 100%;
  
  /* V√≠deo seguindo padr√£o AWS Amplify - centralizado e espelhado ANTES de carregar */
  video {
    position: absolute !important;
    top: 50% !important;
    left: 50% !important;
    transform: translate(-50%, -50%) scaleX(-1) !important;
    -webkit-transform: translate(-50%, -50%) scaleX(-1) !important;
    -moz-transform: translate(-50%, -50%) scaleX(-1) !important;
    -ms-transform: translate(-50%, -50%) scaleX(-1) !important;
    width: 100% !important;
    height: 100% !important;
    object-fit: cover !important;
    object-position: center !important;
    z-index: 1 !important;
  }
  
  /* Canvas de cores (flash) acima do v√≠deo - DEVE aparecer durante processamento */
  canvas.amplify-liveness-freshness-canvas {
    position: absolute !important;
    top: 0 !important;
    left: 0 !important;
    width: 100% !important;
    height: 100% !important;
    z-index: 10 !important; /* Acima do v√≠deo (1), abaixo da elipse (21) */
    opacity: 0.6 !important;
    mix-blend-mode: hard-light !important;
    pointer-events: none !important;
    display: block !important; /* Garantir que apare√ßa */
    visibility: visible !important;
  }
}

/* Sobreposi√ß√µes que n√£o afetam o AWS */
.liveness-overlays {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  width: 100%;
  height: 100%;
  z-index: 25; /* Acima da elipse (21) para mostrar status e verifying */
  pointer-events: none !important; /* ESSENCIAL - n√£o bloquear intera√ß√£o */
}

/* Status - DEVE aparecer durante processamento */
.status-overlay {
  position: absolute;
  top: 10px;
  width: 100%;
  text-align: center;
  color: white;
  font-size: 18px;
  font-weight: 500;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  z-index: 26; /* Acima de tudo para garantir visibilidade */
  text-shadow: 0 2px 4px rgba(0, 0, 0, 0.8); /* Sombra para legibilidade */
  pointer-events: none !important;
}

.status-overlay .spinner {
  display: inline-block;
  width: 20px;
  height: 20px;
  border: 3px solid rgba(255, 255, 255, 0.3);
  border-top-color: white;
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
}

/* Status overlay melhorado para verifying - estilo elegante */
.status-overlay.verifying {
  background: linear-gradient(135deg, rgba(59, 130, 246, 0.15), rgba(139, 92, 246, 0.15));
  padding: 14px 28px;
  border-radius: 16px;
  backdrop-filter: blur(12px);
  -webkit-backdrop-filter: blur(12px);
  box-shadow: 
    0 4px 16px rgba(0, 0, 0, 0.4),
    0 0 0 1px rgba(255, 255, 255, 0.1),
    inset 0 1px 0 rgba(255, 255, 255, 0.2);
  border: 1px solid rgba(255, 255, 255, 0.1);
  
  .spinner {
    width: 24px;
    height: 24px;
    border: 3px solid rgba(59, 130, 246, 0.3);
    border-top-color: #3b82f6;
    border-right-color: #8b5cf6;
    animation: spin 0.9s linear infinite;
    box-shadow: 0 0 12px rgba(59, 130, 246, 0.5);
  }
  
  /* Efeito de brilho sutil */
  &::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(
      90deg,
      transparent,
      rgba(255, 255, 255, 0.1),
      transparent
    );
    animation: shimmer 2s infinite;
    border-radius: 16px;
  }
}

/* Gravando v√≠deo */
.recording-indicator {
  position: absolute;
  top: 55px;
  width: 100%;
  text-align: center;
  color: #ff4b4b;
  font-weight: 600;
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 6px;
  font-size: 14px;
}

.recording-indicator .dot {
  width: 10px;
  height: 10px;
  background: #ff4b4b;
  border-radius: 50%;
  animation: pulse 1s infinite alternate;
}

@keyframes pulse {
  to { opacity: 0.2; }
}

/* Loading */
.loading-overlay {
  position: absolute;
  top: 50%;
  left: 50%;
  /* Usar margin em vez de transform para evitar conflitos */
  margin-top: -40px;
  margin-left: -100px;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 12px;
  color: white;
  font-size: 14px;
  width: 200px;

  .spinner {
    width: 30px;
    height: 30px;
    border: 3px solid rgba(255, 255, 255, 0.3);
    border-top-color: white;
    border-radius: 50%;
    animation: spin 0.9s linear infinite;
  }

  p {
    margin: 0;
    text-align: center;
  }
}

/* Overlay de erro */
.error-overlay {
  position: absolute;
  bottom: 30px;
  width: 100%;
  display: flex;
  justify-content: center;
}

.error-box {
  background: #ffdddd;
  color: #900;
  padding: 14px 20px;
  border-radius: 10px;
  font-size: 14px;
  pointer-events: auto; /* permite clicar no bot√£o */
  text-align: center;
  max-width: 90%;

  h3 {
    margin: 0 0 8px;
    font-size: 16px;
  }

  p {
    margin: 0 0 12px;
  }
}

.retry-btn {
  background: #3b82f6;
  color: white;
  border: none;
  padding: 8px 16px;
  border-radius: 6px;
  cursor: pointer;
  font-weight: 600;
  font-size: 14px;
  transition: background 0.2s;

  &:hover {
    background: #2563eb;
  }
}

/* Overlay de prepara√ß√£o */
.prep-overlay {
  position: absolute;
  inset: 0;
  background: rgba(0, 0, 0, 0.85);
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  z-index: 20;
  text-align: center;
  color: #fff;
}

.prep-content {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 1rem;
}

.preparation-icon {
  font-size: 4rem;
  margin-bottom: 1rem;
}

.prep-overlay h2 {
  font-size: 1.8rem;
  margin: 0 0 0.5rem;
}

.prep-overlay p {
  font-size: 1rem;
  margin: 0;
  opacity: 0.9;
}

.prep-overlay .count {
  margin-top: 16px;
  font-size: 58px;
  font-weight: bold;
}

/* Review Step removido - resultados aparecem na p√°gina principal */

/* Anima√ß√µes */
@keyframes spin {
  to {
    transform: rotate(360deg);
  }
}

@keyframes shimmer {
  0% {
    left: -100%;
  }
  100% {
    left: 100%;
  }
}

/* ==========================================================================
   ESTILOS PARA ELIPSE DO WIDGET AWS - CENTRALIZADA
   ========================================================================== */
::ng-deep {
  /* Garantir que a elipse apare√ßa corretamente e centralizada */
  #aws-liveness-container {
    /* Container de overlay da elipse - centralizar */
    [class*="instruction-overlay"],
    [class*="liveness-overlay"],
    [class*="amplify-liveness-overlay"] {
      position: absolute !important;
      top: 0 !important;
      left: 0 !important;
      width: 100% !important;
      height: 100% !important;
      display: flex !important;
      align-items: center !important;
      justify-content: center !important;
      z-index: 20 !important;
      pointer-events: none !important;
    }
    
    /* Elementos SVG da elipse - centralizar */
    svg[class*="liveness"],
    svg[class*="oval"],
    svg[class*="Oval"],
    .amplify-liveness-oval,
    [class*="amplify-liveness-oval"],
    svg {
      position: absolute !important;
      top: 50% !important;
      left: 50% !important;
      transform: translate(-50%, -50%) !important;
      z-index: 21 !important;
      pointer-events: none !important;
      
      /* Garantir que seja linha branca, n√£o preenchimento */
      fill: none !important;
      stroke: #ffffff !important;
      stroke-width: 2px !important;
      opacity: 1 !important;
    }
    
    /* Paths e elementos internos da elipse */
    svg path,
    svg circle,
    svg ellipse {
      fill: none !important;
      stroke: #ffffff !important;
      stroke-width: 2px !important;
    }
    
    /* Canvas de elipse (se houver) - centralizar */
    canvas[class*="oval"],
    canvas[class*="liveness"]:not([class*="freshness"]) {
      position: absolute !important;
      top: 50% !important;
      left: 50% !important;
      transform: translate(-50%, -50%) !important;
      z-index: 21 !important;
      pointer-events: none !important;
      background: transparent !important;
    }
    
    /* Melhorar visibilidade dos textos de instru√ß√£o - estilo elegante e discreto */
    [class*="instruction"],
    [class*="Instruction"],
    [class*="instruction-text"],
    [class*="InstructionText"],
    [class*="liveness-instruction"],
    [class*="amplify-liveness-instruction"] {
      position: absolute !important;
      top: 50% !important;
      left: 50% !important;
      transform: translate(-50%, -50%) !important;
      z-index: 22 !important;
      pointer-events: none !important;
      
      /* Estilo elegante e discreto */
      color: #ffffff !important;
      font-weight: 500 !important;
      font-size: 16px !important;
      text-shadow: 
        0 2px 6px rgba(0, 0, 0, 0.8),
        0 1px 3px rgba(0, 0, 0, 0.9) !important;
      text-align: center !important;
    }
    
    /* Textos dentro dos overlays de instru√ß√£o - estilo elegante */
    [class*="instruction-overlay"] p,
    [class*="instruction-overlay"] span,
    [class*="instruction-overlay"] div,
    [class*="liveness-overlay"] p,
    [class*="liveness-overlay"] span,
    [class*="liveness-overlay"] div,
    [class*="amplify-liveness-overlay"] p,
    [class*="amplify-liveness-overlay"] span,
    [class*="amplify-liveness-overlay"] div {
      color: #ffffff !important;
      font-weight: 500 !important;
      font-size: 15px !important;
      text-shadow: 
        0 2px 6px rgba(0, 0, 0, 0.8),
        0 1px 3px rgba(0, 0, 0, 0.9) !important;
      /* Remover fundo pesado - apenas sombra de texto elegante */
    }
    
    /* Canvas de cores (flash) - DEVE aparecer durante processamento */
    canvas.amplify-liveness-freshness-canvas {
      position: absolute !important;
      top: 0 !important;
      left: 0 !important;
      width: 100% !important;
      height: 100% !important;
      z-index: 10 !important; /* Entre v√≠deo (1) e elipse (21) */
      opacity: 0.6 !important;
      mix-blend-mode: hard-light !important;
      pointer-events: none !important;
      display: block !important; /* Garantir que apare√ßa */
      visibility: visible !important;
    }
  }
}

/* ==========================================================================
   AJUSTES REFINADOS PARA MOBILE
   ========================================================================== */
@media (max-width: 768px) {
  /* Modal ajustado para mobile */
  .liveness-modal {
    padding: 10px;
  }

  /* Wrapper ajustado para mobile */
  .liveness-aws-wrapper {
    width: 100%;
    max-width: 100vw;
    height: 100vh;
    max-height: 100vh;
    border-radius: 0;
  }

  /* Bot√£o fechar menor no mobile */
  .close-button {
    top: 10px;
    right: 15px;
    width: 32px;
    height: 32px;
    font-size: 20px;
  }

  /* Status overlay ajustado */
  .status-overlay {
    top: 8px;
    font-size: 16px;
    padding: 0 10px;
    
    &.verifying {
      padding: 12px 24px;
      font-size: 16px;

  .spinner {
        width: 20px;
        height: 20px;
        border-width: 2.5px;
      }
    }
  }

  /* Textos de instru√ß√£o ajustados para mobile */
  ::ng-deep {
    #aws-liveness-container {
      [class*="instruction"],
      [class*="Instruction"],
      [class*="instruction-text"],
      [class*="InstructionText"],
      [class*="liveness-instruction"],
      [class*="amplify-liveness-instruction"] {
        font-size: 16px !important;
      }

      [class*="instruction-overlay"] p,
      [class*="instruction-overlay"] span,
      [class*="instruction-overlay"] div,
      [class*="liveness-overlay"] p,
      [class*="liveness-overlay"] span,
      [class*="liveness-overlay"] div,
      [class*="amplify-liveness-overlay"] p,
      [class*="amplify-liveness-overlay"] span,
      [class*="amplify-liveness-overlay"] div {
        font-size: 15px !important;
      }
    }
  }

  /* Recording indicator ajustado */
.recording-indicator {
    top: 45px;
    font-size: 13px;
  }

  /* Ajustes espec√≠ficos para elipse no mobile - descer um pouco */
  ::ng-deep {
    #aws-liveness-container {
      /* Elipse ajustada para mobile - descer um pouco (de 50% para 52%) */
      svg[class*="liveness"],
      svg[class*="oval"],
      svg[class*="Oval"],
      .amplify-liveness-oval,
      [class*="amplify-liveness-oval"],
      svg {
        top: 52% !important; /* Ajustado de 50% para 52% - desce a elipse */
        transform: translate(-50%, -50%) !important;
      }

      /* Canvas de elipse tamb√©m ajustado */
      canvas[class*="oval"],
      canvas[class*="liveness"]:not([class*="freshness"]) {
        top: 52% !important; /* Ajustado de 50% para 52% */
        transform: translate(-50%, -50%) !important;
      }

      /* Instru√ß√µes tamb√©m ajustadas */
      [class*="instruction"],
      [class*="Instruction"] {
        top: 52% !important; /* Ajustado de 50% para 52% */
        transform: translate(-50%, -50%) !important;
      }

      /* V√≠deo ajustado para mobile */
      video {
        object-fit: cover !important;
        object-position: center 48% !important; /* Ajustar posi√ß√£o do v√≠deo para alinhar com elipse */
      }
    }
  }
}

/* Ajustes para telas muito pequenas (smartphones pequenos) */
@media (max-width: 480px) {
  .liveness-aws-wrapper {
    width: 100vw;
    height: 100vh;
  }

  .status-overlay {
    font-size: 14px;
    top: 6px;
  }

  .recording-indicator {
    top: 40px;
    font-size: 12px;
  }

  /* Status overlay ajustado para telas pequenas */
  .status-overlay {
    &.verifying {
      padding: 10px 20px;
      font-size: 14px;
      
      .spinner {
        width: 18px;
        height: 18px;
        border-width: 2.5px;
      }
    }
  }

  ::ng-deep {
    #aws-liveness-container {
      /* Elipse ainda mais ajustada para telas pequenas */
      svg[class*="liveness"],
      svg[class*="oval"],
      svg[class*="Oval"],
      .amplify-liveness-oval,
      [class*="amplify-liveness-oval"],
      svg {
        top: 52.5% !important; /* Ajuste fino adicional */
      }

      canvas[class*="oval"],
      canvas[class*="liveness"]:not([class*="freshness"]) {
        top: 52.5% !important;
      }

      [class*="instruction"],
      [class*="Instruction"] {
        top: 52.5% !important;
      }

      /* Textos de instru√ß√£o ajustados para telas pequenas */
      [class*="instruction"],
      [class*="Instruction"],
      [class*="instruction-text"],
      [class*="InstructionText"],
      [class*="liveness-instruction"],
      [class*="amplify-liveness-instruction"] {
        font-size: 14px !important;
        padding: 5px 10px !important;
      }

      [class*="instruction-overlay"] p,
      [class*="instruction-overlay"] span,
      [class*="instruction-overlay"] div,
      [class*="liveness-overlay"] p,
      [class*="liveness-overlay"] span,
      [class*="liveness-overlay"] div,
      [class*="amplify-liveness-overlay"] p,
      [class*="amplify-liveness-overlay"] span,
      [class*="amplify-liveness-overlay"] div {
        font-size: 13px !important;
        padding: 4px 8px !important;
      }
    }
  }
}

/* Ajustes para orienta√ß√£o landscape no mobile */
@media (max-width: 768px) and (orientation: landscape) {
  .liveness-aws-wrapper {
    height: 100vh;
    max-height: 100vh;
  }

  ::ng-deep {
    #aws-liveness-container {
      svg[class*="liveness"],
      svg[class*="oval"],
      svg[class*="Oval"],
      .amplify-liveness-oval,
      [class*="amplify-liveness-oval"],
      svg {
        top: 51% !important; /* Ajuste diferente para landscape */
      }
    }
  }
}

/* ==========================================================================
   REGRAS OBRIGAT√ìRIAS DA AWS (CR√çTICAS)
   ========================================================================== */
/* 
   üö´ N√£o usar grid, flex parents, transform, translate, scale, 
      animations ou padding no container.
   
   üö´ N√£o colocar nada por cima do widget com pointer-events.
   
   ‚úî Overlays devem sempre ter pointer-events: none.
   
   ‚úî O container deve ser fixo, n√£o din√¢mico.
   
   ‚úî Sem overflow hidden no pai (j√° controlado).
   
   ‚úî Deixar somente o AWS usar flash, bounding box e controle do v√≠deo.
*/
