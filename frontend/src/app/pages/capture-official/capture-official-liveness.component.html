<div class="liveness-modal" 
     *ngIf="isModalOpen()" 
     [class.fadeout]="isClosing()"
     (click)="closeModal()">
  
  <!-- Botão fechar -->
  <button class="close-button" (click)="closeModal()" aria-label="Fechar modal">✕</button>

  <!-- Wrapper isolado do AWS (Full Screen) -->
  <div class="liveness-aws-wrapper" *ngIf="!showReviewStep()" (click)="$event.stopPropagation()">
    <div id="aws-liveness-container">
      <!-- Widget AWS será montado aqui -->
    </div>
    
    <!-- Overlays (não interferem no AWS) - dentro do wrapper -->
    <div class="liveness-overlays">

    <!-- Status -->
    <div class="status-overlay" 
         [class.verifying]="isVerifying()"
         *ngIf="statusMessage() && !errorMessageSignal()">
      <span *ngIf="isVerifying()" class="spinner"></span>
      {{ statusMessage() }}
    </div>

    <!-- Gravando vídeo -->
    <div class="recording-indicator" *ngIf="isRecordingVideo()">
      <div class="dot"></div>
      Gravando vídeo da sessão...
    </div>

    <!-- Loading -->
    <div class="loading-overlay" *ngIf="isLoading()">
      <div class="spinner"></div>
      <p>Aguardando widget carregar...</p>
    </div>

    <!-- Erro -->
    <div class="error-overlay" *ngIf="errorMessageSignal()">
      <div class="error-box">
        <h3>Ocorreu um problema</h3>
        <p>{{ errorMessageSignal() }}</p>
        <button class="retry-btn" (click)="retry()">Tentar novamente</button>
      </div>
    </div>
  </div>

  </div>

  <!-- Review step: no mobile aparece fora do modal (position fixed), na web dentro -->
  <div class="review-wrapper" *ngIf="showReviewStep() && (!isModalOpen() || !isMobile())" (click)="$event.stopPropagation()">
    <app-custom-review-step
      *ngIf="livenessResult()"
      [livenessResult]="livenessResult()!"
      [documentImageS3Path]="documentS3PathSignal() || documentKeySignal() || ''"
      [documentImageUrl]="documentUrlSignal() || undefined"
      (finished)="handleReviewFinished($event)">
    </app-custom-review-step>
  </div>
</div>
