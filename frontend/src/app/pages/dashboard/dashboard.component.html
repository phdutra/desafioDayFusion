<div class="dashboard">
  <header class="dashboard-header">
    <div>
      <h1>DayFusion Liveness</h1>
      <p>POC integrada com AWS Rekognition, S3 e Cognito Identity Pool.</p>
    </div>
    <div class="header-actions">
      <div class="badge">
        <span class="badge-dot live"></span>
        <span>WebRTC Ready</span>
      </div>
      <div class="badge secondary">
        <span class="badge-dot aws"></span>
        <span>AWS Sync</span>
      </div>
    </div>
  </header>

  <section class="grid">
    <app-config-panel
      class="panel"
      [steps]="voiceSteps()"
      (stepsChange)="onStepsChange($event)"
    ></app-config-panel>

    <div class="panel">
      <div class="document-card">
        <h2>Documento de Refer√™ncia</h2>
        <p>Fa√ßa upload de um documento (RG/CNH) para compara√ß√£o facial.</p>

        <div class="document-input">
          <label class="upload-button">
            <input type="file" accept="image/*" (change)="onDocumentSelected($event)" hidden />
            <span>üìÑ Selecionar documento</span>
          </label>

          <div class="document-info" *ngIf="documentFile as doc; else noDocument">
            <div>
              <strong>{{ doc.name }}</strong>
              <p>{{ doc.size / 1024 | number:'1.0-0' }} KB</p>
            </div>
            <button class="btn ghost" (click)="clearDocument()">Remover</button>
          </div>
          <ng-template #noDocument>
            <p class="document-placeholder">Nenhum documento selecionado.</p>
          </ng-template>
        </div>
      </div>

      <app-liveness-modal
        [voiceSteps]="voiceSteps()"
        [documentFile]="documentFile"
        (sessionCompleted)="handleSessionCompleted($event)"
        (sessionFailed)="handleSessionFailed($event)"
      ></app-liveness-modal>
    </div>
  </section>

  <section class="result-section" *ngIf="lastResult() || errorMessage()">
    <h2>Resultado da An√°lise</h2>

    <div class="result-grid" *ngIf="lastResult(); else errorBlock">
      <div class="result-card" [class.approved]="lastResult()?.status === 'Aprovado'" [class.rejected]="lastResult()?.status === 'Rejeitado'">
        <div class="result-header">
          <span class="result-icon">
            {{ lastResult()?.status === 'Aprovado' ? '‚úÖ' : lastResult()?.status === 'Rejeitado' ? '‚ùå' : '‚ö†Ô∏è' }}
          </span>
          <div>
            <h3>Status: {{ lastResult()?.status }}</h3>
            <p>Liveness m√©dio {{ lastResult()?.livenessScore }} ¬∑ Match documento {{ lastResult()?.faceMatchScore ?? 'N/A' }}</p>
          </div>
        </div>

        <pre *ngIf="resultJson()" class="result-json">{{ resultJson() }}</pre>
      </div>

      <div class="captures-card" *ngIf="lastResult()?.captures?.length">
        <h3>Capturas Enviadas ao S3</h3>
        <div class="captures-grid">
          <figure *ngFor="let capture of lastResult()?.captures">
            <img [src]="capture.previewUrl" [alt]="capture.position" />
            <figcaption>
              <strong>{{ capture.position }}</strong>
              <span>Confian√ßa {{ capture.confidence | number:'1.0-0' }}%</span>
            </figcaption>
          </figure>
        </div>
      </div>
    </div>

    <ng-template #errorBlock>
      <div class="result-card rejected">
        <div class="result-header">
          <span class="result-icon">‚ö†Ô∏è</span>
          <div>
            <h3>Falha ao executar sess√£o</h3>
            <p>{{ errorMessage() }}</p>
          </div>
        </div>
      </div>
    </ng-template>
  </section>
</div>

