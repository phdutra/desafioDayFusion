<div class="capture3d-page fade-in-up">
  <section class="intro-card">
    <div class="intro-icon">üîê</div>
    <div class="intro-content">
      <h2 class="intro-title gradient-text">Verifica√ß√£o Facial 3D</h2>
      <p class="intro-description">
        Fluxo completo de liveness com captura autom√°tica de fotos e v√≠deo,
        sincronizado com a AWS e pronto para auditoria.
      </p>
      <ul class="intro-benefits">
        <li>‚úÖ Detec√ß√£o de movimento real</li>
        <li>‚úÖ Anti-deepfake e anti-spoofing</li>
        <li>‚úÖ Capturas enviadas para an√°lise downstream</li>
      </ul>
    </div>
    <div class="intro-actions">
      <button class="btn-dashboard" (click)="openModal()">
        <span class="btn-icon">‚ñ∂</span>
        <span>Iniciar Verifica√ß√£o 3D</span>
      </button>
      <p class="intro-hint">Necess√°rio navegador com HTTPS e permiss√£o de c√¢mera.</p>
    </div>
  </section>

  <!-- 1Ô∏è‚É£ PRIMEIRO: Documento de Refer√™ncia -->
  <section class="document-upload-card">
    <div class="document-content">
      <div class="step-badge">
        <span class="step-number">1</span>
        <h3>Documento de Refer√™ncia</h3>
      </div>
      <p>Primeiro, fa√ßa upload de um documento (RG/CNH) para compara√ß√£o facial.</p>
      <div class="document-input">
        <label class="upload-button">
          <input type="file" accept="image/*" (change)="onDocumentSelected($event)" hidden />
          <span>üìÑ Selecionar documento</span>
        </label>
        <div class="document-info" *ngIf="documentInfo() as info; else noDocument">
          <div>
            <strong>{{ info.name }}</strong>
            <p>{{ info.sizeKb | number:'1.0-0' }} KB</p>
          </div>
          <button class="btn-ghost" type="button" (click)="clearDocument()">Remover</button>
        </div>
        <ng-template #noDocument>
          <p class="document-placeholder">Nenhum documento selecionado.</p>
        </ng-template>
      </div>
    </div>
  </section>

  <!-- 2Ô∏è‚É£ DEPOIS: Sequ√™ncia de Captura -->
  <section class="steps-section">
    <div class="step-badge">
      <span class="step-number">2</span>
      <h3>Sequ√™ncia de Captura Facial</h3>
    </div>
    <p class="section-description">Ap√≥s anexar o documento, clique no bot√£o acima para iniciar a captura facial 3D.</p>
    <div class="steps-grid">
      <div class="step-card" *ngFor="let step of voiceSteps(); index as i">
        <div class="step-index">{{ i + 1 }}</div>
        <div class="step-info">
          <strong>{{ step.texto }}</strong>
          <span>Delay: {{ step.delay }}ms ¬∑ Posi√ß√£o: {{ step.posicao }}</span>
        </div>
      </div>
    </div>
  </section>

  <section class="result-section" *ngIf="statusSummary() as summary">
    <div class="result-card" [class.approved]="summary.status === 'Aprovado'" [class.rejected]="summary.status === 'Rejeitado'" [class.review]="summary.status === 'Revisar'">
      <div class="result-header">
        <div class="result-status">
          <span class="status-icon">
            {{ summary.status === 'Aprovado' ? '‚úÖ' : summary.status === 'Rejeitado' ? '‚ùå' : 'üîç' }}
          </span>
          <div>
            <h4>Status: {{ summary.status }}</h4>
            <p>Sess√£o {{ summary.sessionId }}</p>
          </div>
        </div>
        <div class="result-score">
          <div>
            <span class="score-label">Score Liveness</span>
            <span class="score-value">{{ summary.livenessScore | number:'1.0-0' }}%</span>
          </div>
          <div>
            <span class="score-label">Match Documento</span>
            <span class="score-value">{{ summary.faceMatchScore !== null ? (summary.faceMatchScore | number:'1.0-0') + '%' : 'N/A' }}</span>
          </div>
        </div>
      </div>
    </div>
  </section>

  <div class="status-banner error" *ngIf="errorMessage()">
    <span>‚ö†Ô∏è {{ errorMessage() }}</span>
  </div>

  <!-- Modal de Captura Facial 3D -->
  <div class="modal-overlay" *ngIf="isModalOpen()">
    <div class="modal-wrapper">
      <button class="modal-close" (click)="closeModal()">‚úï</button>
      <app-liveness-modal
        [voiceSteps]="voiceSteps()"
        [documentFile]="documentFile()"
        (sessionCompleted)="handleSessionCompleted($event)"
        (sessionFailed)="handleSessionFailed($event)">
      </app-liveness-modal>
    </div>
  </div>

  <!-- Modal de Alerta: Documento Obrigat√≥rio -->
  <div class="modal-overlay" *ngIf="showAlertModal()">
    <div class="alert-modal">
      <div class="alert-icon">‚ö†Ô∏è</div>
      <h3>Documento Obrigat√≥rio</h3>
      <p>Por favor, anexe um documento de identifica√ß√£o (RG ou CNH) antes de iniciar a verifica√ß√£o facial 3D.</p>
      <div class="alert-steps">
        <div class="alert-step">
          <span class="alert-step-number">1</span>
          <span>Selecione um documento (RG/CNH)</span>
        </div>
        <div class="alert-step">
          <span class="alert-step-number">2</span>
          <span>Clique em "Iniciar Verifica√ß√£o 3D"</span>
        </div>
      </div>
      <button class="btn-alert" (click)="closeAlertModal()">Entendi</button>
    </div>
  </div>
</div>
