<div class="capture-container fade-in-up">
  <h2 class="gradient-text page-title">Face Liveness 3D - Anti-Spoof</h2>

  <!-- Se√ß√£o de Informa√ß√µes -->
  <section class="capture-section">
    <div class="info-container">
      <div class="info-content">
        <div class="info-icon">üîê</div>
        <h3 class="info-title">Verifica√ß√£o 3D com Detec√ß√£o de Liveness</h3>
        <p class="info-description">
          Tecnologia avan√ßada que previne fraudes com deepfakes e fotos est√°ticas. 
          O sistema detecta movimentos reais em tempo real.
        </p>
        
        <div class="features-list">
          <div class="feature-item">
            <span class="feature-icon">‚úÖ</span>
            <span class="feature-text">Detec√ß√£o de movimento real</span>
          </div>
          <div class="feature-item">
            <span class="feature-icon">‚úÖ</span>
            <span class="feature-text">Anti-deepfake</span>
          </div>
          <div class="feature-item">
            <span class="feature-icon">‚úÖ</span>
            <span class="feature-text">Anti-spoofing</span>
          </div>
        </div>

        <div class="warning-message" *ngIf="livenessError">
          <p class="error-text">‚ö†Ô∏è {{ livenessError }}</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Controles -->
  <div class="controls-section">
    <button 
      class="btn btn-primary btn-large" 
      (click)="openCameraModal()" 
      [disabled]="livenessLoading">
      <span class="btn-icon">üîê</span>
      <span>Iniciar Verifica√ß√£o 3D</span>
    </button>

    <button 
      class="btn btn-secondary btn-large" 
      (click)="stopSession()" 
      *ngIf="sessionActive">
      <span class="btn-icon">‚èπÔ∏è</span>
      Finalizar Verifica√ß√£o
    </button>
  </div>

  <!-- Modal da C√¢mera (Reutiliz√°vel) -->
  <app-camera-modal
    #cameraModal
    [isOpen]="showCameraModal"
    mode="3d"
    (close)="closeCameraModal()"
    (livenessStart)="onLivenessStart()"
    (livenessComplete)="onLivenessComplete($event)"
  ></app-camera-modal>

  <!-- Resultado do Liveness -->
  <section class="result-section" *ngIf="livenessResult">
    <div class="result-card" [class.approved]="livenessResult.livenessDecision === 'LIVE'" [class.rejected]="livenessResult.livenessDecision === 'SPOOF'">
      <div class="result-header">
        <div class="result-status">
          <span class="status-icon-large">
            {{ livenessResult.livenessDecision === 'LIVE' ? '‚úÖ' : '‚ùå' }}
          </span>
          <div class="status-info">
            <h3 class="result-title">Verifica√ß√£o 3D Conclu√≠da</h3>
            <span class="status-badge" [class.approved]="livenessResult.livenessDecision === 'LIVE'" [class.rejected]="livenessResult.livenessDecision === 'SPOOF'">
              {{ livenessResult.livenessDecision === 'LIVE' ? 'APROVADO' : livenessResult.livenessDecision === 'SPOOF' ? 'SPOOF DETECTADO' : 'INDETERMINADO' }}
            </span>
          </div>
        </div>
        
        <div class="result-score">
          <div class="score-value">{{ (livenessResult.confidence * 100) | number:'1.1-1' }}%</div>
          <div class="score-label">Confian√ßa</div>
        </div>
      </div>

      <div class="result-message" *ngIf="livenessResult.message">
        <p>{{ livenessResult.message }}</p>
      </div>

      <!-- An√°lise Detalhada do Score (quando score baixo) -->
      <div class="result-analysis" *ngIf="livenessResult.confidence < 0.90 && (livenessResult.lowScoreReasons || livenessResult.recommendations)">
        <h4 class="analysis-title">üìä An√°lise Detalhada</h4>
        
        <div class="analysis-section" *ngIf="livenessResult.qualityAssessment">
          <div class="quality-badge" [class.excellent]="livenessResult.qualityAssessment === 'EXCELLENT'"
               [class.good]="livenessResult.qualityAssessment === 'GOOD'"
               [class.fair]="livenessResult.qualityAssessment === 'FAIR'"
               [class.poor]="livenessResult.qualityAssessment === 'POOR'">
            <span class="quality-label">Qualidade:</span>
            <span class="quality-value">{{ livenessResult.qualityAssessment }}</span>
            <span class="quality-score" *ngIf="livenessResult.qualityScore">
              ({{ livenessResult.qualityScore | number:'1.1-1' }}%)
            </span>
          </div>
        </div>

        <div class="analysis-section" *ngIf="livenessResult.lowScoreReasons && livenessResult.lowScoreReasons.length > 0">
          <h5 class="section-title">‚ö†Ô∏è Raz√µes para Score Baixo</h5>
          <ul class="reasons-list">
            <li *ngFor="let reason of livenessResult.lowScoreReasons">{{ reason }}</li>
          </ul>
        </div>

        <div class="analysis-section" *ngIf="livenessResult.recommendations && livenessResult.recommendations.length > 0">
          <h5 class="section-title">üí° Recomenda√ß√µes</h5>
          <ul class="recommendations-list">
            <li *ngFor="let rec of livenessResult.recommendations">{{ rec }}</li>
          </ul>
        </div>
      </div>

      <!-- Imagem de Refer√™ncia -->
      <div class="result-images-section" *ngIf="livenessResult.referenceImageUrl">
        <h4 class="images-section-title">üì∏ Imagem de Refer√™ncia</h4>
        <div class="reference-image-container">
          <img [src]="livenessResult.referenceImageUrl" alt="Refer√™ncia" class="reference-image">
          <p class="image-caption">Frame capturado para verifica√ß√£o facial downstream</p>
        </div>
      </div>

      <!-- Imagens de Auditoria -->
      <div class="result-images-section" *ngIf="livenessResult.auditImageUrls && livenessResult.auditImageUrls.length > 0">
        <h4 class="images-section-title">üñºÔ∏è Imagens de Auditoria</h4>
        <p class="images-section-subtitle">At√© 4 frames extra√≠dos do v√≠deo selfie para auditoria do processo</p>
        <div class="audit-images-grid">
          <div class="audit-image-item" *ngFor="let imageUrl of livenessResult.auditImageUrls; let i = index">
            <img [src]="imageUrl" [alt]="'Audit image ' + (i + 1)" class="audit-image">
            <span class="audit-image-label">Frame {{ i + 1 }}</span>
          </div>
        </div>
      </div>

      <button class="btn btn-secondary btn-retry" (click)="resetResult()">
        <span class="btn-icon">üîÑ</span>
        Nova Verifica√ß√£o
      </button>
    </div>
  </section>

  <!-- Status da API -->
  <section class="status-section">
    <div class="status-content">
      <h3 class="status-title">üìä Status da Implementa√ß√£o</h3>
      <div class="status-grid">
        <div class="status-item approved">
          <div class="status-icon">‚úÖ</div>
          <div class="status-info">
            <div class="status-label">Backend API</div>
            <div class="status-value">Pronto (AWS SDK 4.x)</div>
          </div>
        </div>
        <div class="status-item approved">
          <div class="status-icon">‚úÖ</div>
          <div class="status-info">
            <div class="status-label">Frontend UI</div>
            <div class="status-value">WebRTC Implementado</div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <div class="hint-info">
    <p><strong>Nota:</strong> Implementa√ß√£o WebRTC base conclu√≠da. Pr√≥ximo passo: Integrar handshake AWS Rekognition para streaming completo.</p>
  </div>
</div>
