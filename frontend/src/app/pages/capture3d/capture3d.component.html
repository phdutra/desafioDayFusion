<div class="capture3d-page fade-in-up">
  <section class="intro-card">
    <div class="intro-icon">ğŸ”</div>
    <div class="intro-content">
      <h2 class="intro-title gradient-text">VerificaÃ§Ã£o Facial 3D</h2>
      <p class="intro-description">
        Fluxo completo de liveness com captura automÃ¡tica de fotos e vÃ­deo,
        sincronizado com a AWS e pronto para auditoria.
      </p>
      <ul class="intro-benefits">
        <li>âœ… DetecÃ§Ã£o de movimento real</li>
        <li>âœ… Anti-deepfake e anti-spoofing</li>
        <li>âœ… Capturas enviadas para anÃ¡lise downstream</li>
      </ul>
    </div>
    <div class="intro-actions">
      <button class="btn-dashboard" (click)="openModal()">
        <span class="btn-icon">â–¶</span>
        <span>Iniciar VerificaÃ§Ã£o 3D</span>
      </button>
      <p class="intro-hint">NecessÃ¡rio navegador com HTTPS e permissÃ£o de cÃ¢mera.</p>
    </div>
  </section>

  <section class="steps-section">
    <h3>SequÃªncia configurada</h3>
    <div class="steps-grid">
      <div class="step-card" *ngFor="let step of voiceSteps(); index as i">
        <div class="step-index">{{ i + 1 }}</div>
        <div class="step-info">
          <strong>{{ step.texto }}</strong>
          <span>Delay: {{ step.delay }}ms Â· PosiÃ§Ã£o: {{ step.posicao }}</span>
        </div>
      </div>
    </div>
  </section>

  <section class="document-upload-card">
    <div class="document-content">
      <h3>Documento de ReferÃªncia</h3>
      <p>FaÃ§a upload de um documento (RG/CNH) para comparaÃ§Ã£o facial nas prÃ³ximas verificaÃ§Ãµes.</p>
      <div class="document-input">
        <label class="upload-button">
          <input type="file" accept="image/*" (change)="onDocumentSelected($event)" hidden />
          <span>ğŸ“„ Selecionar documento</span>
        </label>
        <div class="document-info" *ngIf="documentInfo() as info; else noDocument">
          <div>
            <strong>{{ info.name }}</strong>
            <p>{{ info.sizeKb | number:'1.0-0' }} KB</p>
          </div>
          <button class="btn-ghost" type="button" (click)="clearDocument()">Remover</button>
        </div>
        <ng-template #noDocument>
          <p class="document-placeholder">Nenhum documento selecionado.</p>
        </ng-template>
      </div>
    </div>
  </section>

  <section class="result-section" *ngIf="statusSummary() as summary">
    <div class="result-card" [class.approved]="summary.status === 'Aprovado'" [class.rejected]="summary.status === 'Rejeitado'" [class.review]="summary.status === 'Revisar'">
      <div class="result-header">
        <div class="result-status">
          <span class="status-icon">
            {{ summary.status === 'Aprovado' ? 'âœ…' : summary.status === 'Rejeitado' ? 'âŒ' : 'ğŸ”' }}
          </span>
          <div>
            <h4>Status: {{ summary.status }}</h4>
            <p>SessÃ£o {{ summary.sessionId }}</p>
          </div>
        </div>
        <div class="result-score">
          <div>
            <span class="score-label">Score Liveness</span>
            <span class="score-value">{{ summary.livenessScore | number:'1.0-0' }}%</span>
          </div>
          <div>
            <span class="score-label">Match Documento</span>
            <span class="score-value">{{ summary.faceMatchScore !== null ? (summary.faceMatchScore | number:'1.0-0') + '%' : 'N/A' }}</span>
          </div>
        </div>
      </div>
    </div>
  </section>

  <div class="status-banner error" *ngIf="errorMessage()">
    <span>âš ï¸ {{ errorMessage() }}</span>
  </div>

  <div class="modal-overlay" *ngIf="isModalOpen()">
    <div class="modal-wrapper">
      <button class="modal-close" (click)="closeModal()">âœ•</button>
      <app-liveness-modal
        [voiceSteps]="voiceSteps()"
        [documentFile]="documentFile()"
        (sessionCompleted)="handleSessionCompleted($event)"
        (sessionFailed)="handleSessionFailed($event)">
      </app-liveness-modal>
    </div>
  </div>
</div>
