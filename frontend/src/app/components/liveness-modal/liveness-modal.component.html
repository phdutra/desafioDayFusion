<div class="liveness-container">
  <!-- Container onde o widget AWS será renderizado (conforme guia) -->
  <div id="liveness-widget-container" class="aws-wrapper" *ngIf="isRunning && awsSessionId">
    <!-- Overlay AWS Liveness Widget - DEVE estar DENTRO do mesmo container -->
    <div class="aws-overlay" *ngIf="isRunning && awsSessionId">
      <div class="left-grad"></div>
      <div class="right-grad"></div>
    </div>
  </div>
  
  <!-- Widget AWS invisível mas funcional (fallback para widget custom) -->
  <div class="aws-widget-container" *ngIf="isRunning && awsSessionId && useCustomWidget">
    <face-liveness-widget
      [sessionId]="awsSessionId"
      [streamingUrl]="awsStreamingUrl"
      [region]="awsRegion">
    </face-liveness-widget>
  </div>

  <header class="liveness-header" *ngIf="isRunning || errorMessage">
    <div></div>
    <div class="session-status" [class.running]="isRunning" [class.error]="errorMessage">
      <span class="status-indicator"></span>
      <span>{{ isRunning ? 'Em execução' : errorMessage ? 'Erro' : 'Aguardando' }}</span>
    </div>
  </header>

  <!-- Legenda acima do vídeo -->
  <div class="instruction-label" *ngIf="(statusMessage || errorMessage) && !resultStatus">
    <p [class.error]="errorMessage">{{ errorMessage ?? statusMessage }}</p>
  </div>

<section class="video-section">
  <div class="video-circle">
    <!-- Logo DayFusion quando aprovado - atrás do círculo -->
    <div class="approval-logo-bg" *ngIf="resultStatus === 'approved'">
      <img src="assets/images/logo_dayfusion.png" alt="DayFusion Logo" />
    </div>

    <div class="progress-ring" 
         [class.result-loading]="resultStatus === 'loading'"
         [class.result-approved]="resultStatus === 'approved'"
         [class.result-rejected]="resultStatus === 'rejected'">
      <span
        class="ring-segment"
        *ngFor="let segment of ringSegments"
        [style.transform]="segment.rotation"
        [class.active]="segment.active">
      </span>
    </div>

    <!-- Setas de direção -->
    <div class="direction-arrows" *ngIf="isRunning && currentDirection && currentDirection !== 'center'">
      <div class="arrow arrow-up" [class.active]="currentDirection === 'up'">
        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M12 4L12 20M12 4L6 10M12 4L18 10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
      <div class="arrow arrow-down" [class.active]="currentDirection === 'down'">
        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M12 20L12 4M12 20L6 14M12 20L18 14" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
      <div class="arrow arrow-left" [class.active]="currentDirection === 'left'">
        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M4 12L20 12M4 12L10 6M4 12L10 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
      <div class="arrow arrow-right" [class.active]="currentDirection === 'right'">
        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M20 12L4 12M20 12L14 6M20 12L14 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
    </div>

    <div class="video-mask" [class.has-approved-logo]="resultStatus === 'approved'">
      <video #videoElement autoplay playsinline muted></video>
      <div class="guides">
        <span class="guide vertical"></span>
        <span class="guide horizontal"></span>
      </div>
      <div class="progress-indicator" *ngIf="progress > 0 && resultStatus !== 'approved' && resultStatus !== 'rejected'">
        {{ progress }}%
      </div>
    </div>
  </div>

  <div class="video-overlay" *ngIf="!isRunning && progress === 0">
    <p>Pronto para iniciar a verificação 3D.</p>
    <p class="overlay-hint">Clique em "Iniciar Verificação" e siga as instruções.</p>
  </div>
</section>

  <!-- Resultado após animação -->
  <div class="result-display" *ngIf="resultStatus === 'approved' || resultStatus === 'rejected'">
    <div class="result-content" [class.approved]="resultStatus === 'approved'" [class.rejected]="resultStatus === 'rejected'">
      <!-- Quando aprovado: mostrar apenas score consolidado -->
      <div class="result-score" *ngIf="resultStatus === 'approved'">
        <span class="score-label">Score de Validação:</span>
        <span class="score-value">{{ resultScore }}%</span>
      </div>
      
      <!-- Quando rejeitado: mostrar scores separados para diagnóstico -->
      <ng-container *ngIf="resultStatus === 'rejected'">
        <div class="result-score">
          <span class="score-label">Score:</span>
          <span class="score-value">{{ resultScore }}%</span>
        </div>
        <div class="result-document-score" *ngIf="resultDocumentScore !== null && resultDocumentScore !== undefined">
          <span class="score-label">Score Documento:</span>
          <span class="score-value">{{ resultDocumentScore }}%</span>
        </div>
      </ng-container>
      
      <div class="result-observation" *ngIf="resultObservation">
        <span class="observation-label">Observação:</span>
        <span class="observation-text">{{ resultObservation }}</span>
      </div>
    </div>
  </div>

  <div class="progress-wrapper" *ngIf="progress > 0 && !resultStatus">
    <div class="progress-bar">
      <div class="progress-fill" [style.width.%]="progress"></div>
    </div>
    <span class="progress-value">{{ progress }}%</span>
  </div>

</div>

