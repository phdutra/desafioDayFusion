<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>DayFusion</title>
  <base href="/">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" type="image/x-icon" href="assets/images/logo_dayfusion.png">
  <!-- Content Security Policy: permite blob/scripts necessários para AWS Face Liveness Widget -->
  <!-- Conforme AWS_FaceLiveness_WidgetAccessError.md: CSP restritiva pode bloquear scripts/blob do widget -->
  <meta http-equiv="Content-Security-Policy"
        content="default-src * blob: data: gap:; style-src * 'unsafe-inline'; script-src * 'unsafe-inline' 'unsafe-eval' *">
  <!-- Polyfill para process.env (necessário para widget.js) -->
  <script>
    // Polyfill para process.env usado pelo widget AWS Face Liveness
    if (typeof process === 'undefined') {
      window.process = {
        env: {
          NODE_ENV: 'development'
        }
      };
    }
  </script>
  <!-- AWS SDK (carregado antes do widget para garantir disponibilidade) -->
  <!-- Nota: sem async/defer para garantir carregamento antes do Angular -->
  <script src="https://sdk.amazonaws.com/js/aws-sdk-2.1000.0.min.js"></script>
  <!-- Face Liveness Widget (AWS Amplify UI React como Web Component) -->
  <script 
    src="/assets/liveness/widget.js"
    onerror="window.widgetLoadError = true; window.dispatchEvent(new CustomEvent('widget-load-error', { detail: { src: this.src } }));"
    onload="window.widgetLoadSuccess = true; window.dispatchEvent(new CustomEvent('widget-load-success', { detail: { src: this.src } }));">
  </script>
  <script>
    // Verificar se o widget foi carregado após um tempo
    setTimeout(function() {
      if (!window.widgetLoadSuccess && !window.widgetLoadError) {
        if (typeof customElements !== 'undefined') {
          customElements.whenDefined('face-liveness-widget')
            .then(function() {
              window.widgetLoadSuccess = true;
            })
            .catch(function(err) {
              // Erro ao definir custom element - silencioso
            });
        }
      }
    }, 2000);
  </script>
</head>
<body>
  <app-root></app-root>
</body>
</html>
