<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Frontend</title>
  <base href="/">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="icon" type="image/x-icon" href="favicon.ico">
  <!-- Content Security Policy: permite blob/scripts necess√°rios para AWS Face Liveness Widget -->
  <!-- Conforme AWS_FaceLiveness_WidgetAccessError.md: CSP restritiva pode bloquear scripts/blob do widget -->
  <meta http-equiv="Content-Security-Policy"
        content="default-src * blob: data: gap:; style-src * 'unsafe-inline'; script-src * 'unsafe-inline' 'unsafe-eval' *">
  <!-- Polyfill para process.env (necess√°rio para widget.js) -->
  <script>
    // Polyfill para process.env usado pelo widget AWS Face Liveness
    if (typeof process === 'undefined') {
      window.process = {
        env: {
          NODE_ENV: 'development'
        }
      };
    }
  </script>
  <!-- AWS SDK (carregado antes do widget para garantir disponibilidade) -->
  <!-- Nota: sem async/defer para garantir carregamento antes do Angular -->
  <script src="https://sdk.amazonaws.com/js/aws-sdk-2.1000.0.min.js"></script>
  <!-- Face Liveness Widget (AWS Amplify UI React como Web Component) -->
  <script 
    src="/assets/liveness/widget.js"
    onerror="console.error('‚ùå ERRO CR√çTICO: widget.js falhou ao carregar!', this.src); window.widgetLoadError = true; window.dispatchEvent(new CustomEvent('widget-load-error', { detail: { src: this.src } }));"
    onload="console.log('‚úÖ widget.js carregado com sucesso:', this.src); window.widgetLoadSuccess = true; window.dispatchEvent(new CustomEvent('widget-load-success', { detail: { src: this.src } }));">
  </script>
  <script>
    // Verificar se o widget foi carregado ap√≥s um tempo
    setTimeout(function() {
      if (!window.widgetLoadSuccess && !window.widgetLoadError) {
        console.warn('‚ö†Ô∏è widget.js ainda n√£o sinalizou carregamento ap√≥s 2 segundos');
        console.warn('üí° Verificando se custom element est√° registrado...');
        if (typeof customElements !== 'undefined') {
          customElements.whenDefined('face-liveness-widget')
            .then(function() {
              console.log('‚úÖ Custom element definido ap√≥s timeout');
              window.widgetLoadSuccess = true;
            })
            .catch(function(err) {
              console.error('‚ùå Custom element n√£o foi definido:', err);
            });
        }
      }
    }, 2000);
  </script>
</head>
<body>
  <app-root></app-root>
</body>
</html>
